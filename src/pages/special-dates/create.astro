---
import DashboardLayout from "../../components/layouts/DashboardLayout.astro";
import { apiFetch } from "../../lib/utils/fetch.js";

let error = "";

// Cuando envían el formulario
if (Astro.request.method === "POST") {
  const form = await Astro.request.formData();

  const data = {
    date: form.get("date"),
    name: form.get("name"),
    description: form.get("description") || null
  };

  try {
    await apiFetch("/special-dates", {
      method: "POST",
      body: JSON.stringify(data),
    });

    return Astro.redirect("/special-dates");
  } catch (err) {
    error = err.message || "Error creando la fecha especial.";
  }
}
---

<DashboardLayout title="Crear Fecha Especial">

  <h1 class="text-2xl font-semibold mb-6">Crear Nueva Fecha Especial</h1>

  {error && (
    <p class="p-3 bg-red-100 text-red-600 rounded mb-4">{error}</p>
  )}

  <form method="POST" class="bg-white shadow rounded-lg p-6 max-w-xl">

    <!-- FECHA -->
    <div class="mb-4">
      <label class="block font-medium mb-1">Fecha</label>
      <input type="date" name="date" required class="input" />
    </div>

    <!-- NOMBRE -->
    <div class="mb-4">
      <label class="block font-medium mb-1">Nombre</label>
      <input type="text" name="name" required class="input" />
    </div>

    <!-- DESCRIPCIÓN -->
    <div class="mb-4">
      <label class="block font-medium mb-1">Descripción (opcional)</label>
      <textarea name="description" rows="3" class="input"></textarea>
    </div>

    <!-- BOTONES -->
    <div class="flex gap-3 mt-6">
      <button
        type="submit"
        class="px-5 py-2 bg-[#FF3131] text-white rounded hover:bg-[#FF3232]"
      >
        Crear
      </button>

      <a
        href="/special-dates"
        class="px-5 py-2 bg-gray-300 rounded hover:bg-gray-400"
      >
        Cancelar
      </a>
    </div>

  </form>

</DashboardLayout>

<style>
  .input {
    @apply w-full border rounded px-3 py-2 shadow-sm focus:ring focus:border-blue-400;
  }
</style>
