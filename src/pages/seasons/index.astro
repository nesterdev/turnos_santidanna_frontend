---
import DashboardLayout from "../../components/layouts/DashboardLayout.astro";
import { apiFetch } from "../../lib/utils/fetch.js";

let seasons = [];
let error = "";

try {
  seasons = await apiFetch("/seasons");
} catch (err) {
  error = "No se pudieron cargar las temporadas.";
}
---

<DashboardLayout title="Temporadas">

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-semibold">Listado de Temporadas</h1>

    <a
      href="/seasons/create"
      class="px-4 py-2 bg-[#FF3131] text-white rounded hover:bg-[#FF3232]"
    >
      + Nueva Temporada
    </a>
  </div>

  {error && (
    <p class="p-3 bg-red-100 text-red-600 rounded mb-4">{error}</p>
  )}

  {seasons.length === 0 ? (
    <p class="text-gray-500">No hay temporadas registradas.</p>
  ) : (
    <div class="overflow-x-auto bg-white shadow rounded-lg">
      <table class="min-w-full border-collapse">
        <thead class="bg-gray-100 border-b">
          <tr>
            <th class="table-head">Nombre</th>
            <th class="table-head">Fecha Inicio</th>
            <th class="table-head">Fecha Fin</th>
            <th class="table-head text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {seasons.map(season => (
            <tr class="table-row">
              <td class="table-cell">{season.name}</td>
              <td class="table-cell">{season.start_date}</td>
              <td class="table-cell">{season.end_date}</td>

              <td class="table-cell text-right">
                <a
                  href={`/seasons/view/${season.id}`}
                  class="action-btn text-[#FF3131] hover:text-blue-800"
                >
                  Ver
                </a>

                <a
                  href={`/seasons/edit/${season.id}`}
                  class="action-btn text-green-600 hover:text-green-800"
                >
                  Editar
                </a>

                <button
                  class="action-btn text-red-600 hover:text-red-800"
                  data-id={season.id}
                  data-type="season"
                  data-name={season.name}
                  onclick="openDeleteModal(event)"
                >
                  Eliminar
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )}

</DashboardLayout>

<!-- Scripts -->
<script is:inline>
  import { openDeleteModal } from "../../lib/utils/modal.js";
</script>

<style>
  .table-head {
    @apply text-left px-4 py-2 font-medium text-gray-600;
  }
  .table-row:nth-child(even) {
    @apply bg-gray-50;
  }
  .table-cell {
    @apply px-4 py-2 border-b;
  }
  .action-btn {
    @apply mx-1 text-sm;
  }
</style>
