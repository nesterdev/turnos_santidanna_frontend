---
import DashboardLayout from "../../../components/layouts/DashboardLayout.astro";
import { apiFetch } from "../../../lib/utils/fetch.js";

const { id } = Astro.params;

let season = null;
let error = "";

// Cargar datos de la temporada
try {
  season = await apiFetch(`/seasons/${id}`);
} catch (err) {
  error = "No se pudo cargar la información de la temporada.";
}

// Manejo del formulario
if (Astro.request.method === "POST") {
  const form = await Astro.request.formData();

  const data = {
    name: form.get("name"),
    start_date: form.get("start_date"),
    end_date: form.get("end_date"),
  };

  try {
    await apiFetch(`/seasons/${id}`, {
      method: "PUT",
      body: JSON.stringify(data),
    });

    return Astro.redirect(`/seasons/view/${id}`);
  } catch (err) {
    error = err.message || "Error actualizando la temporada.";
  }
}
---

<DashboardLayout title="Editar Temporada">

  <h1 class="text-2xl font-semibold mb-6">Editar Temporada</h1>

  {error && (
    <p class="p-3 bg-red-100 text-red-600 rounded mb-4">{error}</p>
  )}

  {season ? (
    <form method="POST" class="bg-white shadow rounded-lg p-6 max-w-xl">

      <!-- NOMBRE -->
      <div class="mb-4">
        <label class="block font-medium mb-1">Nombre</label>
        <input
          type="text"
          name="name"
          value={season.name}
          required
          class="input"
        />
      </div>

      <!-- FECHA INICIO -->
      <div class="mb-4">
        <label class="block font-medium mb-1">Fecha Inicio</label>
        <input
          type="date"
          name="start_date"
          value={season.start_date}
          required
          class="input"
        />
      </div>

      <!-- FECHA FIN -->
      <div class="mb-4">
        <label class="block font-medium mb-1">Fecha Fin</label>
        <input
          type="date"
          name="end_date"
          value={season.end_date}
          required
          class="input"
        />
      </div>

      <!-- BOTONES -->
      <div class="flex gap-3 mt-6">
        <button
          type="submit"
          class="px-5 py-2 bg-[#FF3131] text-white rounded hover:bg-[#FF3232]"
        >
          Guardar Cambios
        </button>

        <a
          href={`/seasons/view/${id}`}
          class="px-5 py-2 bg-gray-300 rounded hover:bg-gray-400"
        >
          Cancelar
        </a>
      </div>

    </form>
  ) : (
    <p class="text-gray-500">Cargando información...</p>
  )}

</DashboardLayout>

<style>
  .input {
    @apply w-full border rounded px-3 py-2 shadow-sm focus:ring focus:border-blue-400;
  }
</style>
