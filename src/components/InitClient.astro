---
import { systemSettings, setSettings } from "../lib/stores/settingsStore";
import { user, setUser } from "../lib/stores/userStore";

let initialized = false;

if (typeof window !== "undefined" && !initialized) {
  initialized = true;

  // Recarga persistencia automÃ¡ticamente
  const savedSettings = localStorage.getItem("system_settings");
  const savedUser = localStorage.getItem("app_user");

  if (savedSettings) setSettings(JSON.parse(savedSettings));
  if (savedUser) setUser(JSON.parse(savedUser));
}

 // ðŸ”¹ Registrar Service Worker (PWA sin cache)
  if (typeof window !== "undefined" && "serviceWorker" in navigator) {
    window.addEventListener("load", async () => {
      const registration = await navigator.serviceWorker.register("/sw.js");

      // ðŸ”¥ Forzar actualizaciÃ³n automÃ¡tica
      navigator.serviceWorker.addEventListener("controllerchange", () => {
        window.location.reload();
      });

      // Opcional: log de control
      console.log("SW registrado:", registration.scope);
    });
  }
---

<!-- No renderiza nada, solo ejecuta el script -->
